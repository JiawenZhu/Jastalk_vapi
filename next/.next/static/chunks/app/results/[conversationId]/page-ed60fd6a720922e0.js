(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[110],{3730:function(e,t,r){Promise.resolve().then(r.bind(r,7459))},7459:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var s,n=r(7437),a=r(2265),i=r(9376),c=r(8301);let o=(0,c.Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),l=(0,c.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var d=r(257);let u=(void 0!==d&&(null===(s=d.env)||void 0===s?void 0:s.NEXT_PUBLIC_SERVER_URL)||"").replace(/\/$/,"");function m(){let e=(0,i.useParams)(),t=Array.isArray(null==e?void 0:e.conversationId)?e.conversationId[0]:null==e?void 0:e.conversationId,[r,s]=(0,a.useState)(!0),[c,d]=(0,a.useState)([]),[m,f]=(0,a.useState)(""),[v,x]=(0,a.useState)(null),[p,y]=(0,a.useState)(null),g=async()=>{if(t){s(!0),f("");try{let e=await fetch("".concat(u,"/recordings?conversation_id=").concat(t));if(!e.ok)throw Error("HTTP ".concat(e.status));let r=await e.json();d(r||[])}catch(e){f((null==e?void 0:e.message)||"加载录制失败")}finally{s(!1)}}};(0,a.useEffect)(()=>{g()},[t]),(0,a.useEffect)(()=>{t&&(async()=>{try{var e;let r=await fetch("".concat(u,"/conversations/").concat(t,"/messages"));if(!r.ok)return;let s=await r.json(),n=Array.isArray(null==s?void 0:s.messages)?s.messages.find(e=>{var t;return(null==e?void 0:null===(t=e.content)||void 0===t?void 0:t.type)==="conversation_metadata"}):null;(null==n?void 0:null===(e=n.content)||void 0===e?void 0:e.metadata)&&x(n.content.metadata)}catch(e){}})()},[t]),(0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("sessionId");e&&(async()=>{try{let t=await fetch("".concat(u,"/interview/").concat(e,"/summary"));if(!t.ok)return;let r=await t.json();y((null==r?void 0:r.data)||null)}catch(e){}})()},[]);let w=null==c?void 0:c[0],j=async e=>{try{let t=await fetch("".concat(u,"/recordings/").concat(e,"/download-link"));if(!t.ok)throw Error("无法获取下载链接");let{download_link:r}=await t.json();r&&window.open(r,"_blank")}catch(e){console.error(e)}};return(0,n.jsx)("main",{className:"min-h-screen bg-white p-6",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"面试结果"}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["会话：",t]}),(0,n.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,n.jsxs)("button",{onClick:g,className:"inline-flex items-center gap-2 bg-gray-100 px-3 py-2 rounded",children:[(0,n.jsx)(o,{className:"h-4 w-4"})," 刷新"]}),w&&(0,n.jsxs)("button",{onClick:()=>j(w.recording_id),className:"inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded",children:[(0,n.jsx)(l,{className:"h-4 w-4"})," 下载最新录制"]})]}),v&&(0,n.jsxs)("div",{className:"mt-4 border rounded p-4 bg-gray-50",children:[(0,n.jsx)("div",{className:"font-medium mb-2",children:"面试元数据"}),v.role&&(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["职位：",v.role]}),v.interview_type&&(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["面试类型：",v.interview_type]}),Array.isArray(v.questions)&&v.questions.length>0&&(0,n.jsxs)("div",{className:"text-sm text-gray-700 mt-2",children:[(0,n.jsx)("div",{className:"font-medium",children:"题目："}),(0,n.jsx)("ol",{className:"list-decimal ms-5",children:v.questions.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]})]}),r?(0,n.jsx)("p",{className:"mt-8 text-gray-500",children:"加载中…"}):m?(0,n.jsx)("p",{className:"mt-8 text-red-600",children:m}):0===c.length?(0,n.jsx)("p",{className:"mt-8 text-gray-500",children:"尚未找到录制。"}):(0,n.jsx)("div",{className:"mt-6 grid gap-6",children:c.map(e=>(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"font-medium",children:["录制 ",e.recording_id.slice(0,8)]}),(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:["状态：",e.status,"，创建时间：",new Date(e.created_at).toLocaleString()]})]}),(0,n.jsx)("button",{onClick:()=>j(e.recording_id),className:"text-blue-600 text-sm",children:"下载"})]}),"ready"===e.status&&(0,n.jsx)(h,{recordingId:e.recording_id})]},e.recording_id))}),p&&(0,n.jsxs)("div",{className:"mt-8 border rounded p-4",children:[(0,n.jsx)("div",{className:"font-semibold mb-2",children:"面试评分总结"}),(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["平均得分：",p.average_score,"/100"]}),(0,n.jsxs)("div",{className:"text-sm text-gray-700 mt-1",children:["答题数：",p.answered_questions," / ",p.total_questions]}),(0,n.jsx)("div",{className:"text-sm text-gray-700 mt-2",children:"总体反馈："}),(0,n.jsx)("div",{className:"text-sm whitespace-pre-wrap mt-1",children:p.overall_feedback}),Array.isArray(p.question_scores)&&p.question_scores.length>0&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("div",{className:"font-medium",children:"题目得分明细"}),(0,n.jsx)("ol",{className:"list-decimal ms-5 mt-1",children:p.question_scores.map((e,t)=>(0,n.jsxs)("li",{className:"text-sm",children:[(0,n.jsx)("div",{className:"font-medium",children:e.question}),(0,n.jsxs)("div",{className:"text-gray-600",children:["得分：",e.score]})]},t))})]})]})]})})}function h(e){let{recordingId:t}=e,[r,s]=(0,a.useState)("");if((0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let r=await fetch("".concat(u,"/recordings/").concat(t,"/download-link"));if(!r.ok)return;let{download_link:n}=await r.json();e&&s(n||"")}catch(e){}})(),()=>{e=!1}},[t]),!r)return null;let i=/\.mp4(\?|$)/i.test(r)||/video/.test(r);return(0,n.jsx)("div",{className:"mt-3",children:i?(0,n.jsx)("video",{src:r,controls:!0,className:"w-full rounded"}):(0,n.jsx)("audio",{src:r,controls:!0,className:"w-full"})})}},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},257:function(e,t,r){"use strict";var s,n;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,s,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var o=[],l=!1,d=-1;function u(){l&&s&&(l=!1,s.length?o=s.concat(o):d=-1,o.length&&m())}function m(){if(!l){var e=c(u);l=!0;for(var t=o.length;t;){for(s=o,o=[];++d<t;)s&&s[d].run();d=-1,t=o.length}s=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new h(e,t)),1!==o.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}},i=!0;try{t[e](a,a.exports,s),i=!1}finally{i&&delete r[e]}return a.exports}s.ab="//";var n=s(229);e.exports=n}()},8301:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var s=r(5583),n=r(1780),a=r(6796),i=r(2265),c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var l=(e,t)=>{let r=(0,i.forwardRef)((r,l)=>{var{color:d="currentColor",size:u=24,strokeWidth:m=2,absoluteStrokeWidth:h,children:f}=r,v=(0,a._)(r,["color","size","strokeWidth","absoluteStrokeWidth","children"]);return(0,i.createElement)("svg",(0,s._)((0,n._)((0,s._)({ref:l},c),{width:u,height:u,stroke:d,strokeWidth:h?24*Number(m)/Number(u):m,className:"lucide lucide-".concat(o(e))}),v),[...t.map(e=>{let[t,r]=e;return(0,i.createElement)(t,r)}),...(Array.isArray(f)?f:[f])||[]])});return r.displayName="".concat(e),r}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3730)}),_N_E=e.O()}]);